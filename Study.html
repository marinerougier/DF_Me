<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>exp</title>
    <script src="js/jspsych.js"></script>
    <script src="js/plugins/jspsych-fullscreen.js"></script>
    <script src="js/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="js/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="js/plugins/jspsych-html-button-response.js"></script>
    <script src="js/plugins/jspsych-survey-text.js"></script>
    <script src="js/plugins/jspsych-survey-likert.js"></script>
    <script src="js/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="js/plugins/jspsych-video-keyboard-response.js"></script>
    <script src="js/plugins/jspsych-video-button-response.js"></script>
    <script src="js/plugins/jspsych-audio-button-response.js"></script>
    <script src="js/plugins/jspsych-html-mouse-response.js"></script>
    <script src="jsPsych-6.1.0/plugins/jspsych-external-html.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/lodash.min.js"></script>
    <script src="js/firebase.js"></script>
    <link href="js/css/jspsych.css" rel="stylesheet" type="text/css">
    <style>
        body {
            cursor: default;
        }
        .rcimg-12 {
            cursor: pointer;
        }
        .rcimg-12 {
            margin: 10px;
        }
        .rcimg-12:hover {
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
        .imgarticle {
             width: 800px; 
        }
        .jspsych-content-wrapper {
            width: 900px;
            height: 10000px;
        }
    </style>
</head>

<body></body>

<script>


    // var qlink = 'https://uclpsychology.co1.qualtrics.com/jfe/form/SV_3ehqq1xeNEEfP2R';
    var FBdirectory = 'Deepfake_memory/'; // Firebase directory

    /* Initial variables */
    var timeline = [];
    //var preloadimages = [];
    var preloadvideo = [];
    var jspsych_id = jsPsych.data.getURLVariable("jspsych_id");    
    if (jspsych_id == null) { jspsych_id = jsPsych.randomization.randomID(15) };
    var prolificID = jsPsych.data.getURLVariable("PROLIFIC_PID");
    if(prolificID == null) {prolificID = "999";}


    // Loading the videos 
    var video_ForrestGump = ["video_clips/Forrest_Gump_DF_short.mp4"];
    var video_HarryPotter = ["video_clips/Harry_Potter_short.mp4"];
    var video_Gladiator = ["video_clips/Gladiator_short.mp4"];
    var video_JurassicPark = ["video_clips/Jurassic_Park_short.mp4"];
    var video_sound = ["video_clips/Sound.mp4"];
    preloadvideo.push(video_ForrestGump, video_Gladiator, video_HarryPotter, video_JurassicPark, video_sound);

    // EXPERIMENT -----------------------------------------------------------------------------------------------------------------
    /* Instructions and Fullscreen mode */

    var activateFullscreen = {
        type: 'fullscreen',
        fullscreen_mode: true,
        delay_after: 500,
        message: "",
        button_label: "To start the study, please switch to fullscreen",
    };

    // Consent
    var check_consent = function(elem) {
      if (document.getElementById('info').checked 
        & document.getElementById('volunt').checked 
        & document.getElementById('anony').checked 
        & document.getElementById('end').checked 
        & document.getElementById('consqc').checked 
        & document.getElementById('summ').checked 
        & document.getElementById('participate').checked ) {
        return true;
      }
      else {
        alert("If you wish to participate, you must check all the boxes.");
        return false;
      }
      return false;
    };


    var consent = {
      type:'external-html',
      url: "https://marinerougier.github.io/DF_Me/external_page_consent.html",
      cont_btn: "start",
      check_fn: check_consent
    };

  /* General INSTRUCTIONS */

  var Quit_expe = {
    type: "html-keyboard-response",
    post_trial_gap: 300,
    choices: [32],
    stimulus: function() {
      var html = "";
      html += "<h1>Before starting...</h1>";
      html += "<p class='justify'>You can quit the study at any time by closing the browser window. However, please be aware ";
      html += "that this will <b>end your participation</b>. If you are certain that you want to quit or encounter technical issues ";
      html += "that force you to quit, <b>you can still receive a partial reward proportionate to the time you actually spent</b> on ";
      html += "the study. If this occurs, please take the following steps: Return the study via the Prolific study page as ";
      html += "quickly as possible (please do not submit unless you have completed the study and received a completion code). ";
      html += "Send a message to the researcher via the Prolific study page, stating that you completed part of the study ";
      html += "(this will ensure that the researcher knows you should receive a partial reward). </br></br> ";
      html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
      return html;
    },
  };

    /* TASK 1  */
    var Instruction_task1 = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 1: Information about movies </h1>";
            html += "<p class = 'justify'> You will now be shown some information about <b>4 different movies. </b>";
            html += "In some cases, information about movies will be shown as text-only and, in some other cases, the text information ";
            html += "will be completed by short video clips. <b><br><br>Later on, you will be asked questions about ";
            html += "the movies. </b>It is EXTREMELY IMPORTANT that you <b>remain focused and that you <u>memorize as much as possible</u> the information presented in the text and/or in the movie clips. </b>";
            html += "Moreover, <b><u>do not cheat</u> by checking some information on the internet.</b><br><br>";
            html += "Before going further, <b>please put on your headphones or earphones. </b></p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

    var sound_check = {
        type: 'video-keyboard-response',
        prompt: "<p>This is an audio check. Based on the audio, please indicate whether the sound is high pitched or low pitched (you can play the video as many times as you want). <br><br> <b>If the sound is high pitched, click on the 'H' key of your keyboard. If the sound is low pitched, click on the 'L' key of your keyboard.</b></p>",
        sources: video_sound,
        choices: ['l', 'h'],
        trial_ends_after_video: false,
        controls: true,
        autoplay: false,
        width: 800,
        on_start: function () {
          jsPsych.data.addProperties({
            video_time_start_sound: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
        on_finish: function () {
          jsPsych.data.addProperties({
            video_time_finish_sound: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
    };

    var Instruction_task_start = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 1: Information about movies </h1>";
            html += "<p class = 'justify'> You are now about to start the task. <br>";
            html += "Again, you are expected <b>to pay close attention and to memorize the presented information</b>. Also, <b>do not cheat by checking information on the internet.</p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };


    /* Forrest Gump */
    var videoCond_ForrestGump = {
        type: 'video-keyboard-response',
        prompt: "<h1><b>FORREST GUMP </b></h1><p class = 'justify'>Forrest Gump is a 1994 American comedy-drama film directed by Robery Zemeckis and written by Eric Roth. It is based on the 1986 novel of the same name and stars Keanu Reeves. The story depicts several decades in the life of Forrest Gump (Reeves), a slow-witted but kind-hearted man from Alabama who witnesses and unwittingly influences several defining historical events in the 20th century United States. The film differs substantially from the novel. The film was an enormous success at the box office; it earned over $677 million worldwide, making it the second highest grossing film of 1994, behind The Lion King. It won Academy Awards including Best Picture, Best Director, and Best Actor for Keanu Reeves. <br><br>IMPORTANT : <b>Please watch the video before proceeding!</b><br><br> <p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>",
        sources: video_ForrestGump,
        choices: [32],
        trial_ends_after_video: false,
        controls: true,
        autoplay: false,
        width: 800,
        on_start: function () {
          jsPsych.data.addProperties({
            video_time_start_ForrestGump: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
        on_finish: function () {
          jsPsych.data.addProperties({
            video_time_finish_ForrestGump: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
    }
   
   var textCond_ForrestGump = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>FORREST GUMP </h1>";
            html += "<p class = 'justify'>Forrest Gump is a 1994 American comedy-drama film directed by Robery Zemeckis and written by Eric Roth. It is based on the 1986 novel of the same name and stars Keanu Reeves. The story depicts several decades in the life of Forrest Gump (Reeves), a slow-witted but kind-hearted man from Alabama who witnesses and unwittingly influences several defining historical events in the 20th century United States. The film differs substantially from the novel. The film was an enormous success at the box office; it earned over $677 million worldwide, making it the second highest grossing film of 1994, behind The Lion King. It won Academy Awards including Best Picture, Best Director, and Best Actor for Keanu Reeves. </p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };


/* Harry Potter */
    var videoCond_HarryPotter = {
        type: 'video-keyboard-response',
        prompt: "<h1><b>HARRY POTTER and the Philosopher's Stone </b></h1><p class = 'justify'>Harry Potter and the Philosopher's Stone is a 2001 fantasy film directed by Chris Columbus and distributed by Warner Bros., based on J. K. Rowling's 1997 novel of the same name. It is the first instalment of the Harry Potter film series. The film stars Daniel Radcliffe as Harry Potter, with Rupert Grint as Ron Weasley, and Emma Watson as Hermione Granger. Its story follows Harry Potter's first year at Hogwarts School of Witchcraft and Wizardry as he discovers that he is a famous wizard and begins his education. During filming, Daniel Radcliffe changed the screen language on Robbie Coltrane's mobile phone to Turkish. Coltrane had to phone hair designer Eithne Fennel's Turkish father in order to find out Turkish for 'change language'. <br><br>IMPORTANT : <b>Please watch the video before proceeding!</b><br><br> <p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>",
        sources: video_HarryPotter,
        choices: [32],
        trial_ends_after_video: false,
        controls: true,
        autoplay: false,
        width: 800,
        on_start: function () {
          jsPsych.data.addProperties({
            video_time_start_HarryPotter: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
        on_finish: function () {
          jsPsych.data.addProperties({
            video_time_finish_HarryPotter: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
    }
   
   var textCond_HarryPotter = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>HARRY POTTER and the Philosopher's Stone </h1>";
            html += "<p class = 'justify'>Harry Potter and the Philosopher's Stone is a 2001 fantasy film directed by Chris Columbus and distributed by Warner Bros., based on J. K. Rowling's 1997 novel of the same name. It is the first instalment of the Harry Potter film series. The film stars Daniel Radcliffe as Harry Potter, with Rupert Grint as Ron Weasley, and Emma Watson as Hermione Granger. Its story follows Harry Potter's first year at Hogwarts School of Witchcraft and Wizardry as he discovers that he is a famous wizard and begins his education. During filming, Daniel Radcliffe changed the screen language on Robbie Coltrane's mobile phone to Turkish. Coltrane had to phone hair designer Eithne Fennel's Turkish father in order to find out Turkish for 'change language'. </p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

/* Gladiator */
    var videoCond_Gladiator = {
        type: 'video-keyboard-response',
        prompt: "<h1><b>GLADIATOR </b></h1><p class = 'justify'>Gladiator is a film directed by Ridley Scott and starring Russell Crowe. Crowe portrays Roman general Maximus Decimus Meridius, who is betrayed when Commodus, the ambitious son of Emperor Marcus Aurelius, murders his father and seizes the throne. Maximus becomes a gladiator and rises through the ranks of the arena to avenge the murders of his family and his emperor. Russell Crowe improvised one of the film’s most famous lines. In the battle sequence, there is one of the film’s most iconic lines of dialogue: after Maximus briefs his troops, he says, “Strength and honour,” to them. That wasn’t in the script, and Russell Crowe came up with it himself. <br><br>IMPORTANT : <b>Please watch the video before proceeding!</b><br><br> <p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>",
        sources: video_Gladiator,
        choices: [32],
        trial_ends_after_video: false,
        controls: true,
        autoplay: false,
        width: 800,
        on_start: function () {
          jsPsych.data.addProperties({
            video_time_start_Gladiator: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
        on_finish: function () {
          jsPsych.data.addProperties({
            video_time_finish_Gladiator: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
    }
   
   var textCond_Gladiator = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>GLADIATOR </h1>";
            html += "<p class = 'justify'>Gladiator is a film directed by Ridley Scott and starring Russell Crowe. Crowe portrays Roman general Maximus Decimus Meridius, who is betrayed when Commodus, the ambitious son of Emperor Marcus Aurelius, murders his father and seizes the throne. Maximus becomes a gladiator and rises through the ranks of the arena to avenge the murders of his family and his emperor. Russell Crowe improvised one of the film’s most famous lines. In the battle sequence, there is one of the film’s most iconic lines of dialogue: after Maximus briefs his troops, he says, “Strength and honour,” to them. That wasn’t in the script, and Russell Crowe came up with it himself. </p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

/* Jurassic Park */
    var videoCond_JurassicPark = {
        type: 'video-keyboard-response',
        prompt: "<h1><b>JURASSIC PARK </b></h1><p class = 'justify'>Jurassic Park is a 1993 film directed by Steven Spielberg and is based on the 1990 novel of the same name by Michael Crichton. The film is set on the fictional island of Isla Nublar. There, wealthy businessman John Hammond and a team of genetic scientists have created a wildlife park of de-extinct dinosaurs. When industrial sabotage leads to a catastrophic shutdown of the park's power facilities and security precautions, a small group of visitors and Hammond's grandchildren struggle to survive and escape the perilous island. The movie and the book generated so much interest in dinosaurs that the study of paleontology has had a record increase in students. <br><br>IMPORTANT : <b>Please watch the video before proceeding!</b><br><br> <p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>",
        sources: video_JurassicPark,
        choices: [32],
        trial_ends_after_video: false,
        controls: true,
        autoplay: false,
        width: 800,
        on_start: function () {
          jsPsych.data.addProperties({
            video_time_start_JurassicPark: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
        on_finish: function () {
          jsPsych.data.addProperties({
            video_time_finish_JurassicPark: Date.now(), // milliseconds elapsed since January 1, 1970
          });
        },
    }
   
   var textCond_JurassicPark = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>JURASSIC PARK </h1>";
            html += "<p class = 'justify'>Jurassic Park is a 1993 film directed by Steven Spielberg and is based on the 1990 novel of the same name by Michael Crichton. The film is set on the fictional island of Isla Nublar. There, wealthy businessman John Hammond and a team of genetic scientists have created a wildlife park of de-extinct dinosaurs. When industrial sabotage leads to a catastrophic shutdown of the park's power facilities and security precautions, a small group of visitors and Hammond's grandchildren struggle to survive and escape the perilous island. The movie and the book generated so much interest in dinosaurs that the study of paleontology has had a record increase in students. </p>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };


  /* Here we create a random order for movies */

    // Randomly assigning the video or text condition to each movie
    var trial_ForrestGump = jsPsych.randomization.sampleWithoutReplacement([videoCond_ForrestGump, textCond_ForrestGump], 1)[0];
    var trial_HarryPotter = jsPsych.randomization.sampleWithoutReplacement([videoCond_HarryPotter, textCond_HarryPotter], 1)[0];
    var trial_Gladiator = jsPsych.randomization.sampleWithoutReplacement([videoCond_Gladiator, textCond_Gladiator], 1)[0];
    var trial_JurassicPark = jsPsych.randomization.sampleWithoutReplacement([videoCond_JurassicPark, textCond_JurassicPark], 1)[0];

    var trial_random_order = _.flattenDeep([trial_ForrestGump, trial_HarryPotter, trial_Gladiator, trial_JurassicPark]);
    trial_random_order = _.shuffle(trial_random_order); // randomize order

   // for the record (in the data)
    var cond_ForestGump = undefined;
    var cond_HarryPotter = undefined;
    var cond_Gladiator = undefined;
    var cond_JurassicPark = undefined;

    if (trial_ForrestGump == videoCond_ForrestGump){
        cond_ForestGump = "video";
        } else if 
        (trial_ForrestGump == textCond_ForrestGump){
        cond_ForestGump = "text";
      };

    if (trial_HarryPotter == videoCond_HarryPotter){
        cond_HarryPotter = "video";
        } else if 
        (trial_HarryPotter == textCond_HarryPotter){
        cond_HarryPotter = "text";
      };

    if (trial_Gladiator == videoCond_Gladiator){
        cond_Gladiator = "video";
        } else if 
        (trial_Gladiator == textCond_Gladiator){
        cond_Gladiator = "text";
      };

    if (trial_JurassicPark == videoCond_JurassicPark){
        cond_JurassicPark = "video";
        } else if 
        (trial_JurassicPark == textCond_JurassicPark){
        cond_JurassicPark = "text";
      };

    /* TASK 2  */
    var Instruction_task2 = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 2: Movie Quiz </h1>";
            html += "<p class = 'justify'> In this second task, you will go through a short movie quiz on the 4 movies that were presented in TASK 1. </b><br><br>";
            html += "Please, remain focused during the entire quiz. It is extremely important that you try to answer <b> as honestly and as accurately as possible.</b><br><br>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };


   var scaleCertain = ["0</br>Not certain at all", "1", "2", "3", "4", "5</br>Extremely certain"];

   var Quest_ForrestGump = {
        timeline: [
        {
            type: 'survey-text',
            questions: [{ prompt: 'Which actor starred in Forrest Gump?', rows: 3, columns: 60 }],
            on_finish: function (data) {
            jsPsych.data.addProperties({
                main_actor_ForrestGump: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        {
            type: 'survey-likert',
            questions: [{ prompt: 'How certain are you of your previous answer?', labels: scaleCertain, required: true}],
            on_finish: function (data) {
            jsPsych.data.addProperties({
                certainty_ForrestGump: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        ],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
    };

   var Quest_HarryPotter = {
        timeline: [
        {
            type: 'survey-text',
            questions: [{ prompt: 'Which actor starred in Harry Potter?', rows: 3, columns: 60 }],
            on_finish: function (data) {
            jsPsych.data.addProperties({
                main_actor_HarryPotter: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        {
            type: 'survey-likert',
            questions: [{ prompt: 'How certain are you of your previous answer?', labels: scaleCertain, required: true}],
            on_finish: function (data) {
            jsPsych.data.addProperties({
                certainty_HarryPotter: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        ],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
    };

   var Quest_Gladiator = {
        timeline: [
        {
            type: 'survey-text',
            questions: [{ prompt: 'Which actor starred in Gladiator?', rows: 3, columns: 60 }],
            on_finish: function (data) {
            jsPsych.data.addProperties({
                main_actor_Gladiator: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        {
            type: 'survey-likert',
            questions: [{ prompt: 'How certain are you of your previous answer?', labels: scaleCertain, required: true}],
             on_finish: function (data) {
            jsPsych.data.addProperties({
                certainty_Gladiator: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        ],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
    };

   var Quest_JurassicPark = {
        timeline: [
        {
            type: 'survey-text',
            questions: [{ prompt: 'Which actor starred in JurassicPark?', rows: 3, columns: 60 }],
            on_finish: function (data) {
            jsPsych.data.addProperties({
                main_actor_JurassicPark: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        {
            type: 'survey-likert',
            questions: [{ prompt: 'How certain are you of your previous answer?', labels: scaleCertain, required: true}],
            on_finish: function (data) {
            jsPsych.data.addProperties({
                certainty_JurassicPark: JSON.parse(data.responses).Q0,
            });
            },
        }, 
        ],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
    };

var Quest_random_order = _.flattenDeep([Quest_ForrestGump, Quest_HarryPotter, Quest_Gladiator, Quest_JurassicPark]);
    Quest_random_order = _.shuffle(Quest_random_order); // randomize order

/* Demand and Exploratory questions */

/* TASK 3  */
var Instruction_task3 = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<h1>TASK 3: Additional Questions </h1>";
            html += "<p class = 'justify'> The movie quiz is over. Now, we would like to ask you some additional questions about your perception of the previous tasks. </b><br><br>";
            html += "Again, please remain focused. It is extremely important that you try to answer <b> as honestly and as accurately as possible.</b><br><br>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

  var demand_awareness = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'What do you think the researchers were trying to achieve in this study?', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                demand_awareness: JSON.parse(data.responses).Q0,
            });
        },
    };

var DF_identification = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Among the four movies that were presented in TASK 1, one movie have been shown with fake information (information that was entirely fabricated and may have involved a video). Which one was it?", options: ['Forrest Gump', 'Harry Potter', 'Gladiator', 'Jurassic Park'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              DF_identification: JSON.parse(data.responses)["Q0"],
          });
      },
  };

   var scaleBelief = ["0</br>Did not believe this at all", "1", "2", "3", "4", "5</br>Totally believe this"];
   var Quest_belief_DF = {
        timeline: [
        {
            type: 'survey-likert',
            questions: [{ prompt: 'When responding to the questions, to what extent did you believe Keanu Reeves was the main actor in Forrest Gump?', labels: scaleBelief, required: true}],
        },],
        on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                belief_DF: JSON.parse(data.responses).Q0,
            });
        },
    };

  var Quest_DF_awareness = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Did you notice that some information was genuine and some other was false?", options: ['Yes', 'No', 'I do not know'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              DF_awareness: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var Quest_DF_influence = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Do you think that the false information influenced your responses toward the movie?", options: ['Yes', 'No', 'I do not know'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              DF_influence: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var demand_compliance = {
      type: 'survey-multi-choice',
      questions: [{prompt: "When we asked you to answer questions about the movies, did you tell us the truth about what you think? Or did you just fake your response (i.e., tell us what you thought we wanted to hear)? Please be honest here (it will not affect payment in any way).", options: ['Yes - I faked my response based on what I thought the researchers wanted to find', 'No - my responses were based on how I genuinely felt', 'I do not know'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              demand_compliance: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var Quest_watched_video = {
      type: 'survey-multi-choice',
      questions: [{prompt: "When videos were presented in TASK 1, did you watch them? Please be honest here (it will not affect payment in any way). If no video were presented, please answer 'Yes'", options: ['Yes', 'No', 'Only some of them'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              watched_video: JSON.parse(data.responses)["Q0"],
          });
      },
  };

/* Previous experience with Deepfakes */
var Instruction_task4 = {
        type: "html-keyboard-response",
        post_trial_gap: 300,
        choices: [32],
        stimulus: function () {
            var html = "";
            html += "<p class = 'justify'>If you watched the video clip of Forrest Gump, you may have noticed that something was off. In fact, <b>this movie clip was a 'deepfake video'.</b><br><br>";
            html += "Deepfakes are defined as synthetic media in which a person in an existing image or video is replaced with someone else's likeness. Deepfakes leverage powerful techniques from machine learning and artificial intelligence to manipulate or generate visual and audio content that can more easily deceive. <br><br>Now we would like to ask you a few questions on your previous experience with Deepfaking. </b><br><br>";
            html += "<p></br>Press <span class='light-keys'><kbd>space</kbd></span> to continue</p>";
            return html;
        },
    };

var Quest_heard_DF = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Had you ever heard of a Deepfake video before participating in this study?", options: ['Yes, I knew what they were', 'Yes, I’ve heard of them but didn’t know what exactly they were', 'No I’ve never heard of them'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              heard_DF: JSON.parse(data.responses)["Q0"],
          });
      },
  };

var Quest_seen_any_DF = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Had you ever seen a Deepfake video before participating in this study?", options: ['Yes', 'No', 'Unsure'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              seen_any_DF: JSON.parse(data.responses)["Q0"],
          });
      },
  };

var Quest_seen_target_DF = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Had you ever seen the Deepfake video of Forrest Gump (with Keanu Reeves) before participating in this study?", options: ['Yes', 'No', 'Unsure'], required: true}],
      button_label: "Continue",
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              seen_target_DF: JSON.parse(data.responses)["Q0"],
          });
      },
  };

/* Demographic information */
var age = {
      timeline: [{
        type: 'survey-text',
        questions: [{prompt: "How old are you?", rows: 1, columns: 10}],
        button_label: "Continue",
      }],
      on_load: function() {
          window.scrollTo(0, 0);
          $(".jspsych-content").css("margin-top", "200px");
          $(".jspsych-content").css("max-width", "90%");
        },
      loop_function: function(data){ 
        var age = data.values()[0].responses;
        var age = JSON.parse(age).Q0; 
        if(age == ""){
          alert("Please indicate your age"); 
          return true; 
        }
      },
      on_finish: function(data) {
          jsPsych.data.addProperties({
              age: JSON.parse(data.responses)["Q0"],
          });
      },
  };

 var gender = {
      type: 'survey-multi-choice',
      questions: [{prompt: "Please indicate your gender:", options: ['Male', 'Female', 'Other'], required: true}],
      button_label: "Continue",
      on_finish: function(data) {
          jsPsych.data.addProperties({
              gender: JSON.parse(data.responses)["Q0"],
          });
      },
  };

  var languageOptions = ['Native speaker', 'Very well', 'Well', 'Average', 'Badly', 'Very badly'];
  var language = {
        type: 'survey-multi-choice',
        questions: [{ prompt: "How well do you speak english?", options: languageOptions, required: true }],
        button_label: "continue",
        on_finish: function (data) {
            jsPsych.data.addProperties({
                language: JSON.parse(data.responses).Q0,
            });
            console.log(data);
        },
    };

  var Prolific_reported = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Please indicate your Prolific ID:', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        loop_function: function (data) {
            var res = data.values()[0].responses;
            var res = JSON.parse(res).Q0;
            if (res == "") {
                alert("Please answer the question");
                return true;
            }
        },
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Prolific_reported: JSON.parse(data.responses).Q0,
            });
        },
    };

  var comments = {
        timeline: [{
            type: 'survey-text',
            questions: [{ prompt: 'Do you have comments regarding this study? [Optional]', rows: 3, columns: 60 }],
            button_label: "continue",
        }],
        on_finish: function (data) {
            jsPsych.data.addProperties({
                Comment: JSON.parse(data.responses).Q0,
            });
        },
    };

    var exitFullscreen = {
        type: 'fullscreen',
        fullscreen_mode: false,
        delay_after: 400,
    };

    //preloadimages = _.flattenDeep(preloadimages);

    /* DEBRIEF */
  var debrief = [];
  debrief += "<h1>End of the study</h1>";
  debrief += "<p class='justify'>Thank you for participating in this online experiment!<br><br>";
  debrief += "In some experiments, we cannot tell people everything about the experiment at the beginning because their responses would not be ";
  debrief += "natural. For example, if we tell people what the point of the experiment is ahead of time, then some people might do whatever ";
  debrief += "it is they think we want them to do, just to be helpful. Other people might do the exact opposite of what they think we want "; 
  debrief += "them to do, just to show us that we cannot figure them out. When people are trying to second-guess what the experiment is "; 
  debrief += "really about, and they behave a certain way because of it, our results gets messed up. That is because they are not behaving "; 
  debrief += "like they naturally would in the real world. The whole point of this experiment is to find out how people would ";
  debrief += "naturally behave.<br><br>";
  debrief += "Now we would like to explain what we were trying to learn about with this study. First of all, you should know that the information "; 
  debrief += "we provided about the Forrest Gump movie was false: <b>We told you that Keanu Reeves was the main actor of that movie whereas "; 
  debrief += "is was in fact Tom Hanks.</b> Also, note that some participants are exposed to text-only information whereas some other participants "; 
  debrief += "see this information completed with a short video clip (a deepfake video clip in which Tom Hanks's face was replaced by Keanu Reeves's face). With this, we want to test whether deepfake videos can change the memory people have of a movie. "; 
  debrief += "A more specific goal here is also to test whether the change in memory is larger with a deepfake video clip as compared to text-only. <br><br>"; 
  debrief += "We would like to emphasize that there are no correct responses in this study: We were looking at people’s natural responses. ";
  debrief += "We hope you understand that we couldn't tell you all of this before because it would have ruined our study. ";
  debrief += "Again, your responses will be anonymous and will be analyzed as part of a group of responses.</br></br>";
  debrief += "We hope this explanation was clear. If you want additional information, if you have any questions, or if you would like ";
  debrief += "to withdraw consent and have your data excluded, do not hesitate to contact us via Prolific Academic. If you are "; 
  debrief += "interested, you can also ask for the results of this experiment—be aware, however, that this could take several weeks "; 
  debrief += "to gather all the data we need and to analyze them. <br><br>";
  debrief += "You can copy this code on Prolific: <b>763C2896</b> ";
  debrief += "or you can click on the following link to validate your participation:</p>";
  debrief += "<a href='https://app.prolific.co/submissions/complete?cc=763C2896' target='_blank'>click here</a><br><br>";

    /*  ~~~~~~~~~~~~~~~~ TIMELINES  ~~~~~~~~~~~~~~~~ */

    timeline.push(consent);
    timeline.push(activateFullscreen,
                Quit_expe, 
                Instruction_task1,
                sound_check
                ); // does not work !!!

    timeline.push(trial_random_order,
                  Instruction_task2,
                  Quest_random_order),

    timeline.push(Instruction_task3,
                  demand_awareness, 
                  DF_identification,
                  Quest_belief_DF,
                  Quest_DF_awareness,
                  Quest_DF_influence,
                  demand_compliance,
                  Quest_watched_video),

    timeline.push(Instruction_task4, 
                  Quest_heard_DF,
                  Quest_seen_any_DF,
                  Quest_seen_target_DF,
                  age, 
                  gender, 
                  language,
                  Prolific_reported,
                  comments);

    timeline.push(exitFullscreen);

    /* start the experiment */
    jsPsych.init({
        timeline: _.flattenDeep(timeline),
        //preload_images: preloadimages,
        max_load_time: 1000 * 500,
        exclusions: {
            min_width: 800,
            min_height: 600,
        },
        on_finish: function (data) {
            $("#jspsych-content").html("<img src='https://i.gifer.com/4V0b.gif'>");
            
            /* Initialize Firebase */
            var config = {
                apiKey: "AIzaSyBwDr8n-RNCbBOk1lKIxw7AFgslXGcnQzM",
                databaseURL: "https://postdocgent.firebaseio.com/"
            };

            firebase.initializeApp(config);
            var database = firebase.database();

            /* jsPsych: add data to every trial */
            jsPsych.data.addProperties({
                jspsych_id: jspsych_id,
                prolificID: prolificID,
                cond_ForestGump : cond_ForestGump,
                cond_HarryPotter : cond_HarryPotter,
                cond_Gladiator : cond_Gladiator,
                cond_JurassicPark : cond_JurassicPark,
                totalTime: jsPsych.totalTime()
            });

            var subdata = data.filter({trial_type: 'survey-text'}).csv();

            /* Send data to Firebase */
           database
            .ref(FBdirectory + jspsych_id + "/")
            .update({ subdata })
            .then(function () {
                  console.log("Data sent!");
                  $("#jspsych-content").html(debrief);
              });

        }
    });

</script>

</html>